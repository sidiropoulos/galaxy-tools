<tool id="hrf_preprocessing" version="0.1" name="Preprocessing" force_history_refresh="True">
    <description>HRF-Seq raw reads</description>
    <requirements>
        <requirement type="package" version="1.4.2">cutadapt</requirement>
	<requirement type="package" version="0.1.18">samtools</requirement>
	<requirement type="package" version="2.1.0">bowtie2</requirement>
    </requirements>

    <command interpreter="bash">
        preprocessing.sh

	## Inputs
	$input1 $input2

	## Barcode sequence
	$barcode_seq

	## Cutadapt options
	$adapter1 $adapter2 $quality_cutoff $log
	
	## Trimming length
	$trim 
	
	## Minimum overlap length
	$overlap_length

	## Outputs
	$output1 $output2 $barcodes

    </command>

    <inputs>
        <param format="fastqsanger" name="input1" type="data" label="FASTQ file (read 1)" help="Must have Sanger-scaled quality values (fastqsanger)." />
        <param format="fastqsanger" name="input2" type="data" label="FASTQ file (read 2)" help="Must have Sanger-scaled quality values (fastqsanger)." />

	<param name="barcode_seq" type="text" size="20" label="Barcode sequence" help="Reads that do not start with the signature will be removed. Use IUPAC alphabet, e.g. NNNNXRTYNN as in the randomized part of the ligation adapter." />

	<param name="adapter1" type="text" size="40" value="AGATCGGAAGAGCACACGTCT" label="Read 1 3' adapter." help="Reverse complement of an adapter introduced in the reverse transcription, excluding gene-specific or random region. The adapter itself and anything that follows is trimmed." />

        <param name="adapter2" type="text" size="40" value="AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGT" label="Read 2 3' adapter." help="Sequence of an adapter that was ligated to the cDNA 3' end, excluding random barcode sequence. The adapter itself and anything that follows is trimmed." />

        <param name="quality_cutoff" type="integer" min="0" optional="true" value="17" label="Quality cutoff" help="Trim low-quality ends from reads before adapter removal. The algorithm is the same as the one used by BWA (Subtract CUTOFF from all qualities; compute partial sums from all indices to the end of the sequence; cut sequence at the index at which the sum is minimal). Value of 0 means no quality trimming." />

	<param name="trim" type="integer" min="0" optional="true" value="15" label="3' trimming length" help="Number of random bases for random priming, will be removed as they are likely to differ from a template." />

        <param name="overlap_length" type="integer" min="1" optional="true" value="3" label="Minimum overlap length" help="If the overlap between the read and the adapter is shorter than LENGTH, the read is not modified. This reduces the no. of bases trimmed purely due to short random adapter matches." />

    </inputs>

    <outputs>
	<data format="fastqsanger" name="output1" label="${tool.name} on ${on_string}: Read 1" />
	<data format="fastqsanger" name="output2" label="${tool.name} on
 ${on_string}: Read 2" />
	<data format="tabular" name="barcodes" label="${tool.name} on ${on_string}: Barcodes" />
	<data format="txt" name="log" label="${tool.name} on ${on_string}: Cutadapt log" />
    </outputs>

    <help>
    </help>

</tool>
